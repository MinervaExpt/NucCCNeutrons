#!/usr/bin/env ProcessAnaTuples
#Example of how to do an analysis in target 5 using my own analysis.

#TODO: Put this combination of models in its' own header and call it MnvGENIEv1
model: *MnvGENIEv1 #From CommonModels.yam

app:
  #TODO: candidate algorithm and other such options

#TODO: Figure out how to configure cuts that define neutron candidates.
#      This is really more of a reconstruction step, but I have to do it
#      now for flexibility of cut decisions and systematics.
signal: !NeutronMultiplicitySignal
  name: "Neutron Multiplicity"
  variable: &Variable
    truth:
      MinEDep: !MeV 10 #Not many detectable candidates below this threshold
    reco:
      MinEDep: !MeV 1.5 #Just above cross-talk
      MaxZDist: !mm 1500 #roughly tuned for tracker
  binning: &bins [ 0, 1, 2, 4, 10] #TODO: Accept any number of neutrons in last bin and label as > 4 

cuts:
  truth:
    phaseSpace:
      MuonMomentum: !MuonMomentum
        min: !GeV 2
      TrackAngle: !TrackAngle
        max: 20 #degrees; stricter constraint for the targets
    signal:
      Antineutrino: !IsAntineutrino
      LowQ3: &Q3Range !Q3Range
        max: !GeV 0.4
      Apothem: &ApothemCut !Apothem
        apothem: !mm 850
      Target5: *OneTrackTarget5
      Iron: !Target5Iron
  reco:
    OneTrack: !nTracks
      max: 1
    LowQ3: &Q3Range !Q3Range
        max: !GeV 0.4
    MinosDeltaT: !MinosDeltaT
      min: !ns -40
      max: !ns 110
    TrackAngle: !TrackAngle
      max: 20 #degrees; stricter constraint for the targets
    MuonMomentum: !MuonMomentum
      min: !GeV 2
    Antineutrino: !IsAntineutrino
    Apothem: *ApothemCut
    Target5: *OneTrackTarget5
    Iron: !Target5Iron

#Names in sidebands' "fails" blocks refer to truth cuts by block name.
sidebands:
  UpstreamPlastic: !NeutronMultiplicitySideband
    variable: *Variable
    binning: *bins
    fails: [Target5]
    passes:
      Upstream: &USPlastic !Between
        us: *OneTrackTarget5
        ds: *OneTrackTracker
  DownstreamPlastic: !NeutronMultiplicitySideband
    variable: *Variable
    binning: *bins
    fails: [Target5]
    passes:
      Downstream: &DSPlastic !Between
        us: *OneTrackTarget4
        ds: *OneTrackTarget5
  WrongMaterial: !NeutronMultiplicitySideband
    variable: *Variable
    binning: *bins
    fails: [Iron]
    #And implicitly passes the Target5 truth cut

#Backgrounds are defined by the truth::Cuts they pass in addition to
#failing some regular truth cut.  So, these cuts had better be mutually
#exclusive with regular truth::Cuts.
backgrounds:
  UpstreamPlastic:
    Upstream: *USPlastic
  DownstreamPlastic:
    Downstream: *DSPlastic
  Lead:
    IsInLead: !Target5Lead
